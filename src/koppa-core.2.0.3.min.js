const koppa=(()=>{const binder=function(_____,____){return eval(`((${Object.keys(_____).map(a=>`${a} = _____.${a}`).join(", ")}) => {
      let koppa, binder, item, _____, ____; return ${____};
    })();`)},dataTypes={string:"String",number:"Number",array:"Array",element:"Element",object:"Object",function:"Function",bool:"Bool"},functionTypes={arrow:"Arrow",async:"Async",normal:"Normal"},stringTypes={json:"Json",normal:"Normal"};(()=>{const a={length:{get(){return Object.keys(this).length}},isObject:{get(){return"object"==typeof this&&null!==this}},isString:{get(){return"string"==typeof this||this instanceof String}},isBool:{get(){return!!(this.isString&&("true"===this.trim()||"1"===this.trim()||"false"===this.trim()||"0"===this.trim()))||!0===this||1===this||!1===this||0===this||"boolean"==typeof this||this instanceof Boolean}},isJson:{get(){try{JSON.parse(this)}catch(a){return!1}return!0}},isFunction:{get(){return!!(this&&this.constructor&&this.call&&this.apply)}},isArrow:{get(){return"function"==typeof this&&/^([^{=]+|\(.*\)\s*)?=>/.test(this.toString().replace(/\s/,""))}},isAsync:{get(){return"AsyncFunction"===this[Symbol.toStringTag]}},isNumber:{get(){return!!("number"==typeof this||this.isString&&this.match(/^[-+]?[0-9]*[,.]?[0-9]*$/g))}},isElement:{get(){return"object"==typeof HTMLElement?this instanceof HTMLElement:this&&"object"==typeof this&&null!==this&&1===this.nodeType&&"string"==typeof this.nodeName}},toNumber:{get(){const a=+this?+this:this.replace(/,/g,".").replace(/^\./g,"0.").replace(/\.$/g,".00");return"number"==typeof a?a:a.match(/^[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?$/)?parseFloat(a):parseInt(a,10)}},toBool:{get(){if(this.isBool){if(this.isString){if("true"===this.trim()||"1"===this.trim())return!0;if("false"===this.trim()||"0"===this.trim())return!1}return!0===this||1===this||!1!==this&&0!==this&&!!this}return!1}},getType:{get(){return this.isString?dataTypes.string:this.isBool?dataTypes.bool:this.isFunction?dataTypes.function:this.isNumber?dataTypes.number:this.isElement?dataTypes.element:Array.isArray(this)?dataTypes.array:dataTypes.object}},getFunctionType:{get(){return this.isArrow?functionTypes.arrow:this.isAsync?functionTypes.async:functionTypes.normal}},getStringType:{get(){return this.isJson?stringTypes.json:stringTypes.normal}},watch:{enumerable:!1,configurable:!0,writable:!1,value(a,b){let c,d;c=this[a],d=c;const e=()=>d,f=e=>(c=d,d=b.call(this,a,c,e),d);delete this[a]&&Object.defineProperty(this,a,{get:e,set:f,enumerable:!0,configurable:!0})}}},b={getNodeList:{get(){return(a,b)=>{let c;const d=[];a||(a="all"),a.isFunction&&(b=a,a="all"),c="element"===a?NodeFilter.SHOW_ELEMENT:"text"===a?NodeFilter.SHOW_TEXT:"comment"===a?NodeFilter.SHOW_COMMENT:"all"===a?NodeFilter.SHOW_ALL:NodeFilter.SHOW_ALL;const e=a=>!b||b(a)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP,f=document.createTreeWalker(this,c,e,!1);for(;f.nextNode();)d.push(f.currentNode);return d}}},toggleClass:{get(){return a=>(a.split(/, */g).forEach(a=>this.classList.toggle(a)),this)}},addClass:{get(){return a=>(this.classList.add(a),this)}},removeClass:{get(){return a=>(this.classList.remove(a),this)}},hasClass:{get(){return a=>!!this.classList.contains(a)}},replaceWith:{get(){return a=>{const b=this.parentNode;a?.isElement?b.replaceChild(a,this):a?.isString&&(this.before(a),this.remove())}}},siblings:{get(){return a=>{const b=[];for(let c=this.parentNode.firstChild;c;)1===c.nodeType&&c!==this&&(a&&a(c),b.push(c)),c=c.nextSibling;return b}}},before:{get(){return a=>{a.isElement?this.parentNode.insertBefore(a,this):a.isString&&this.insertAdjacentHTML("beforebegin",a)}}},after:{get(){return a=>{a.isElement?this.nextSibling?this.parentNode.insertBefore(a,this.nextSibling):this.parentNode.append(a):a.isString&&this.insertAdjacentHTML("afterend",a)}}},prepend:{get(){return a=>{a.isElement?1>this.children.length?this.append(a):this.firstElementChild.before(a):a.isString&&this.insertAdjacentHTML("afterbegin",a)}}},append:{get(){return a=>{a.isElement?this.appendChild(a):a.isString&&this.insertAdjacentHTML("beforeend",a)}}},html:{get(){return a=>{this.innerHTML=a.isString?a:a.outerHTML}}},attr:{get(){return(a,b)=>(void 0!==b&&this.setAttribute(a,b||"true"),this.getAttribute(a))}}};Object.defineProperties(Object.prototype,{length:a.length,isObject:a.isObject,isString:a.isString,isBool:a.isBool,isJson:a.isJson,isFunction:a.isFunction,isArrow:a.isArrow,isAsync:a.isAsync,isNumber:a.isNumber,isElement:a.isElement,toNumber:a.toNumber,toBool:a.toBool,getType:a.getType,watch:a.watch}),Object.defineProperties(String.prototype,{getStringType:a.getStringType}),Object.defineProperties(Function.prototype,{getFunctionType:a.getFunctionType}),Object.defineProperties(DocumentFragment.prototype,{getNodeList:b.getNodeList}),Object.defineProperties(HTMLElement.prototype,{getNodeList:b.getNodeList,toggleClass:b.toggleClass,addClass:b.addClass,removeClass:b.removeClass,hasClass:b.hasClass,replaceWith:b.replaceWith,siblings:b.siblings,before:b.before,after:b.after,prepend:b.prepend,append:b.append,html:b.html,attr:b.attr})})();const utils=(()=>{const usedIds=[],customEvents={},triggers={},getId=()=>{const a=Math.floor(99999999*Math.random());return usedIds.includes(a)?getId():a},getIdent=a=>{const b=a.dataset.instance?.split("|")||[getId(),null],c=b[0]?.toNumber;let d=b[1]?.toNumber;if(!d){const b=a.closest(`[data-instance]:not([data-instance="${a.dataset.instance||""}"])`);b&&(d=b.dataset.instance.split("|")[0]||null)}return a.dataset.instance=`${c}${d?`|${d}`:""}`,a.instanceId=c,{self:c,parent:d}},replaceData=(strg,data)=>strg.replace(/\{\{([^{{}}]*)\}\}/g,(m,c)=>{if(":"===c[0])return`{{${c.substr(1)}}}`;const declarations=`const ${Object.keys(data).map(a=>`${a} = data['${a}']`).join("; const ")};`;let ret=eval(`try { ${declarations} ${c} } catch { 'undefined' }`);return ret?.isFunction?ret=ret():null===ret&&(ret="null"),ret}),buildTrigger=(a,b)=>{const c=a.name.substr(1);customEvents[c]||(customEvents[c]=new Event(c));const d=triggers[c];b.addEventListener(d?.type,()=>{document.querySelector(d.target).dispatchEvent(customEvents[c])})},createTrigger=(a,b,c)=>{triggers[a]={type:b,target:c||"body"}};return{getId,getIdent,replaceData,buildTrigger,binder,createTrigger}})(),module=(()=>{return new Proxy({},{get:(a,b)=>a[b],set:async(a,b,c)=>(a[b]=c,!0)})})(),transformer=(()=>{const a={source:[a=>{let b=-1;return a=a.replace(/<[^/]?\s*[\w]{1}[\w\d]*-[\w\d]+\s*[^>]*>/g,a=>a.replace(/:([\w]{1}[\w\d]*)(="([^"]*)")?/g,(a,c,d,e)=>(b+=1,"obj"===c?`:p${b}="${`$_${e.replace(/({{)|(}})/g,"")}`}|${e}"`:e?`:p${b}="${c}|${e}"`:`:p${b}="${c}"`))),a},a=>(a=new DOMParser().parseFromString(a,"text/html"),a={template:a.children[0].children[0].children[0].innerHTML.trim()||"",script:a.children[0].children[0].children[1].innerHTML.trim()||"data: {}",style:a.children[0].children[0].children[2].innerHTML.trim()||""},a)]};return{add:async(b,c)=>a[b].push(c),run:async(b,d)=>!!d&&(await a[b]?.reduce((a,b)=>a.then(async()=>{d=b.isAsync?await b(d):b(d)}),Promise.resolve(null)),d)}})(),mediator=(()=>{const mediators={connected:[],build:[function(instance){instance.fragment.getNodeList("element",a=>a.hasAttribute("loop")).forEach(loopNode=>{const attr=utils.replaceData(loopNode.getAttribute("loop"),instance.data).split(" in ");loopNode.removeAttribute("loop");const data=utils.binder(instance.data,`(() => ${attr[1]})()`);let ret="";data&&data.forEach((item,i)=>{ret+=loopNode.outerHTML.replace(/\{\{([^â¹‡]*?)\}\}/g,(m,c)=>eval(`(() => {const ${attr[0]} = ${JSON.stringify(item)}; const n = '${i}'; return ${c};})()`))}),loopNode.replaceWith(ret)})},function a(b,c,d){let e=[],f=[];c||(c=b.fragment.getNodeList("element")),d||(d=b.fragment.getNodeList("text"));const g=document.createElement("div");c.forEach(a=>{[...a.attributes].forEach(c=>{c.name.startsWith("@")&&utils.buildTrigger(c,a),c.value=utils.replaceData(c.value,b.data)})}),d.forEach(a=>{if(" "!==a.data)for(g.innerHTML=utils.replaceData(a.data,b.data);g.firstChild;){const b=g.firstChild;a.before(b),"#text"!==b.nodeName&&(f=f.concat(b.getNodeList("element")),e=e.concat(b.getNodeList("text")))}a.remove()}),g.remove(),(f.length||e.length)&&a(b,f,e)},function(a){a.fragment.getNodeList("element",a=>a.hasAttribute("if")).forEach(b=>{const c=b.getAttribute("if"),d=utils.binder(a.data,`(() => { try { return ${c}; } catch { return false; } })()`);d?b.removeAttribute("if"):b.remove()})}],after:[]},add=async(a,b)=>mediators[a].push(b),run=async(a,b)=>{await mediators[a]?.reduce((a,d)=>a.then(async()=>{d.isAsync?await d(b):d(b)}),Promise.resolve(null))};return{add,run}})(),instance=(()=>{function a(a,b){const c=document.createElement("template");c.innerHTML=b;const d=c.content.getNodeList("element",a=>a.nodeName.includes("-"));return d.forEach((b,c)=>{d[c].dataset.instance=`${utils.getId()}|${a}`}),c}function b(a){const b={};return[...a.element.attributes].filter(a=>a.name.startsWith(":p")).forEach(c=>{const d=c.value.split("|");let e=`${d[0]}`;d[0].match(/^\$_/)&&(e=e.slice(2),b.$obj=e),a.parent?.data[e]||a.parent?.data[e]?.isNumber?b[e]=a.parent.data[e]:[b[e]]=[d[1]],a.element.removeAttribute(c.name)}),b}function c(a){const b=a?.props,c=a?.parent?.childProps;Object.entries(b)?.forEach(([d])=>{void 0===c[a.id]&&(c[a.id]={}),c[a.id][d]=b[d]})}function d(a,b,c){if(b!==c){const a=setTimeout(()=>{clearTimeout(a),this.reConnect()},2)}return c}function e(a,b){return b?.forEach(b=>a.data.watch(b,d.bind(a))),b}function f(a,b){return void 0!==a.parent?.data[b]&&void 0!==a.parent?.childProps?.[a.id]?.[b]?f(a.parent,b):a}function g(a,b,c){if(b!==c&&(this.parent.data[a]!==c&&this.parent?.childProps?.[this.id]?.[a]!==c&&(this.parent.childProps[this.id][a]=c,this.parent.data[a]=c),Object.keys(this.childProps).forEach(b=>{const d=b;this.childProps[d][a]!==c&&k[d].data[a]!==c&&(this.childProps[d][a]=c,k[d].data[a]=c)}),!l)){const b=setTimeout(()=>{clearTimeout(b),f(this,a).reConnect()},2),c=setTimeout(()=>{clearTimeout(c),l=!1},100);l=!0}return c}function h(a,b){if(!a)return null;const c={};return Object.keys(a).forEach(d=>{a[d].isFunction&&(c[d]=a[d].bind(b))}),c}function i(b,c){if(!b)return null;const d=[];return b.forEach(a=>{a[2].isFunction&&d.push([a[0],a[1],a[2].bind(c)])}),d}function j(a){a.events.forEach(b=>{const c=b[0],d=b[1],e=b[2];let f=[],g=[];c.isString?f=c.split(","):c.isElement?f.push(c):Array.isArray(c)&&(f=c),f.forEach(b=>{b.isElement?g.push(b):g=g.concat([...a.fragment.querySelectorAll(b)])}),g.forEach(b=>{b.addEventListener(d,e.isArrow?e:e.bind(a.data))})})}const k={};let l=!1;return new Proxy(k,{get:(a,b)=>a[b],set:async(d,f,l)=>{const m=l[0],n=l[1],o=utils.getIdent(m),p=k[o.self]||{id:o.self,name:f,parent:k[o.parent]||null,html:m.outerHTML,isStopped:!1,isUpdating:!1};if(p.element=m,p.refs={},p.slots={},p.reConnect=()=>{p.isUpdating=!0,p.element.replaceWith(p.html)},p.element.currentInstanceId=p.id,p.element.destroy=()=>{p.element.remove()},p.isStopped)return p.element.remove(),!1;p.template||(p.template=a(p.id,n[f].template)),p.fragment=p.template.content.cloneNode(!0),p.fragment.getNodeList("element",a=>a.hasAttribute("ref")).forEach(a=>{p.refs[a.getAttribute("ref")]=a,a.removeAttribute("ref")});const q=p.element.querySelectorAll("[slot]");q.length?q.forEach(a=>{p.slots[a.slot]=a.outerHTML}):p.slots._=p.element.innerHTML;const r=p.fragment.querySelectorAll("slot");r&&r.forEach(a=>{a.name||a.replaceWith(p.slots._),a.replaceWith(p.element.querySelector(`[slot="${a.name}"]`)?.outerHTML)});const s={refs:p.refs,slots:p.slots,stopRendering:()=>{p.isStopped=!0},reConnect:p.reConnect,...module},t=utils.binder({$:s},`{ ${n[f]?.script} }`);if(p.childProps={},p.props=b(p),c(p),p.data=p.data?Object.assign(p.data,p.props):Object.assign(t.data,p.props),Object.keys(p.props).forEach(a=>{"$obj"!==a&&p.data.watch(a,g.bind(p))}),t.comp&&Object.values(t.comp).forEach(a=>{p.data[a.name]=a.call(p.data)}),p.methods=h(t.methods,p.data),p.data=Object.assign(p.data,t.methods),t.watching&&(p.watching=e(p,t.watching)),p.pre=t.pre?.bind(p.data),p.created=t.created?.bind(p.data),p.merged=t.merged?.bind(p.data),p.destroy=t.destroy?.bind(p.data),p.updated=t.updated?.bind(p.data),p.events=i(t.events,p.data),p.pre?.isAsync?await p.pre():p.pre?.(),p.isStopped)return p.element.remove(),!1;if(document.head.querySelector(`style[data-name="${f}"]`)||document.head.append(`<style data-name="${f}">${n[p.name].style}</style>`),p.element.innerHTML="",p.childs={},p.fragment.getNodeList("element",a=>a.nodeName.includes("-")).forEach(a=>{p.childs[utils.getIdent(a).self]=a}),await mediator.run("build",p),p.created?.isAsync?await p.created():p.created?.(),p.isStopped)return p.element.remove(),!1;for(p.events&&j(p);p.fragment.firstElementChild;)m.append(p.fragment.firstElementChild);return p.merged?.isAsync?await p.merged():p.merged?.(),!0===p.isUpdating&&(p.updated?.isAsync?await p.updated():p.updated?.(),p.isUpdating=!1),Reflect.set(d,o.self,p),!0}})})(),component=(()=>{return new Proxy({},{get:(a,b)=>a[b],set:async(a,b,c)=>(c=await transformer.run("source",c),customElements.define(b,class extends HTMLElement{async connectedCallback(){instance[b]=await(async()=>[this,component])();const a=b=>{const c=setTimeout(async()=>{clearTimeout(c),instance[this.instanceId]?b.isAsync?await b(instance[this.instanceId]):b(instance[this.instanceId]):a(b)},50)};a(async()=>{await mediator.run("connected",this)})}disconnectedCallback(){this.destroy?.()}}),a[b]=c,!0)})})(),fetcher=()=>{const a={},b=async(a,b)=>{const c=await fetch(a,b).then(a=>a).catch(b=>{let c=500,d="Internal Server Error";switch(b.toString()){case"Unauthorized":c=401,d="Unauthorized";break;case"Not Found":c=404,d="Not Found";break;default:c=500,d="Internal Server Error";}return{body:null,bodyUsed:!1,content:null,headers:{},ok:!1,redirected:!1,status:c,statusText:d,type:"basic",url:a}});return c},c=async(c,d)=>{let e=c.replace(/^\/|\.\//,`${window.location.origin}/`);e.includes(window.location.origin)||/^((http|https|ftp):\/\/)/.test(e)||(e=`${window.location.origin}/${e}`),d.credentials=e.match(new RegExp(window.location.origin,"ig"))?"include":"same-origin";let f=a[e];return a[e]||(f=await b(c,d)),f},d=async(b,e=0)=>{b.headers||(b.headers={}),b.mode="cors",b.cache="default",e+=1,"GET"!==b.method&&(b.headers["Content-Type"]=b.data.isObject?"application/json;charset=utf-8":"text/plain;charset=utf-8",b.body=JSON.stringify(b.data));const f=await c(b.url,b);if(f?.ok)f.content||(f.content=await f.text()),b&&b.isObject&&b.save&&!a[f.url]&&(a[f.url]=f);else if(e<1){const a=await d(b,e);return a}return f};return{get:async a=>{a.isString&&(a={url:a}),a.method="GET";const b=await d(a);return b},post:async a=>{a.method="POST";const b=await d(a);return b},put:async a=>{a.method="PUT";const b=await d(a);return b},delete:async a=>{a.method="DELETE";const b=await d(a);return b}}},store=()=>{const a=a=>{const b=b=>!!(b&&a.getItem(b));return{set:(b,c)=>b&&c?a.setItem(b,JSON.stringify(c)):null,get:c=>c&&b(c)?JSON.parse(a.getItem(c)):null,exists:b,remove:b=>!!(b&&a.removeItem(b)),clear:()=>(a.clear(),!!a.length),length:()=>a.length}};return{local:a(localStorage),session:a(sessionStorage)}},router=a=>{async function b(b){const c=m();let d=!0;c?((!window.history.state||!1!==window.history.state.middleware)&&(d=!b.data[b.data.$obj].middleware||(await b.data[b.data.$obj].middleware(c))),!0===d&&(d=!c.handler||(await c.handler(c.params))),!0===d&&(d=c.component),!1===d&&(d="error-404"),d.isString&&(void 0===a.component[d]?(d="error-404",this.html(`<${d}></${d}>`)):this.html(`<${d}></${d}>`))):(d="error-404",this.html(`<${d}></${d}>`)),e=c}function c(a){window.addEventListener("popstate",async()=>{await b.call(this,a)},!0)}const d=[];let e=null;const f=new Event("popstate",null),{protocol:g}=window.location,{hostname:h}=window.location,{port:i}=window.location,j=`${g}//${h}${i?`:${i}`:""}`,k=a=>a.toString().replace(/\/+/g,"/").replace(/((\/$)|(^\/)|(^\.\.\/)|(^\.\/))/g,"").replace(/http:\/+/g,"http://").replace(/https:\/+/g,"https://"),l=a=>{let b="";return a.forEach(a=>{b+=`${""===b?"":"/"}${k(a)}`}),b},m=()=>{let a=!1;if(!d.length)return a;const b=k(window.location.pathname),c=b.split("/");return d.forEach(b=>{b.params={};const d=b.path.split("/");c.length===d.length&&d.forEach((e,f)=>{if(":"===e.charAt(0)){const a=e.slice(1,e.length-1).split("<"),d=new RegExp(a[1],"g");d.test(c[f])&&(b.params[a[0]]=c[f])}f===d.length-1&&(a=b)})}),a},n=a=>{let b=!1;a.path=k(a.path),d.forEach(c=>{b=c.path===a.path}),b||(a.params={},d.push(a))},o=a=>a.forEach(a=>{a.handler&&(a.handler=a.handler.bind(a)),n(a)}),p=(a="",b={})=>{window.renderCounter=0,window.history.pushState(b,null,l([j,a])),dispatchEvent(f)},q=()=>e.params;return a.mediator.add("connected",async d=>{if("router-view"===d.localName){const e=a.instance[d.instanceId];c.call(d,e),e.data.$obj&&(o(e.data[e.data.$obj].routes),await b.call(d,e))}}),a.mediator.add("after",()=>{document.querySelectorAll("[push]").forEach(a=>{a.attr("href",a.attr("push")),a.removeAttribute("push"),a.addEventListener("click",a=>{a.preventDefault(),p(a.target.closest("[href]").attr("href"))})})}),a.take("router-view","<template></template><script></script><style></style>"),{add:n,push:p,replace:(a="",b={})=>{window.renderCounter=0,window.history.replaceState(b,null,l([j,a])),dispatchEvent(f)},getParams:q,basePath:j,clearSlashes:k,urlBuilder:l}};let mutate=!1;const observer=new MutationObserver(a=>{a.forEach(()=>{if(!mutate){const a=setTimeout(async()=>{clearTimeout(a),await mediator.run("after")},50),b=setTimeout(()=>{clearTimeout(b),mutate=!1},100);mutate=!0}})});document.onreadystatechange=()=>{if("complete"===document.readyState){const a=setTimeout(async()=>{clearTimeout(a),await mediator.run("after"),observer.observe(document.querySelector("body"),{subtree:!0,childList:!0})},200)}};const take=async(a,b)=>{if(a.isFunction){const b={utils:{getId:utils.getId,getIdent:utils.getIdent,createTrigger:utils.createTrigger},module,component,instance,transformer,mediator,take},c=a.isAsync?await a(b):a(b);c?.isObject&&(module[a.name]=c)}else if(b.match(/^\.\/[a-z0-9_@\-^!#$%&+={}./\\[\]]+\.html/)){const c=await module.fetcher.get(b);component[a]=c.content}else component[a]=b};take(fetcher),take(store),take(router);const core=a=>document.body.prepend(`<${a}></${a}>`);return core.take=take,core})();
